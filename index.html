<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Data in Table</title>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            padding-bottom: 40px; /* Adding bottom padding to prevent overlap */
        }

        /* Navbar Styles */
        nav {
            background-color: #2C3930;
            padding: 10px;
            text-align: center;
            width: 100%;
        }

        nav a {
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            margin: 0 10px;
            font-weight: bold;
            border-radius: 4px;
        }

        nav a:hover {
            background-color: #4CAF50;
        }

        /* General Section Styles */
        section {
            display: none;
        }

        section.active {
            display: block;
        }

        h2 {
            text-align: center;
            padding: 20px;
            background-color: #2C3930;
            color: white;
            margin: 0;
        }

        #search-input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            margin: 10px 0;
            box-sizing: border-box;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            overflow-x: auto;
            border: 1px solid #ddd;
            position: relative;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            background-color: #2C3930;
            color: white;
        }

        td:first-child {
            width: 15%;
        }

        td:nth-child(3) {
            font-weight: bold;
        }

        .stocks-red {
            color: red;
        }

        .stocks-green {
            color: green;
        }

        .stocks-normal {
            color: black;
        }

        .updated-row {
            background-color: #fffae6;
        }

        /* Sync Icon */
        #sync-icon {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 30px;
            color: #2C3930;
            display: block;
            z-index: 2;
            animation: rotateSync 1s infinite linear;
        }

        @keyframes rotateSync {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .tyre {
            background: #bdc2bd;
            border: 15px solid #333;
            height: 35px;
            width: 35px;
            border-radius: 50%;
            position: absolute;
            top: 1.1%;
            left: 20%;
            animation: rotateTyre 0.8s infinite linear, moveTyre 4s infinite linear;
            margin: 20px;
            z-index: 1;
        }

        @keyframes rotateTyre {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes moveTyre {
            from {
                left: 0;
            }
            to {
                left: 100%;
            }
        }

        /* Stock In & Stock Out Sections */
        .stock-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #fff;
            margin: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .stock-section select,
        .stock-section input,
        .stock-section button {
            width: 100%;
            max-width: 300px;
            padding: 12px;
            margin: 10px 0;
            font-size: 16px;
            border-radius: 4px;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }

        .stock-section button {
            background-color: #2C3930;
            color: white;
            cursor: pointer;
        }

        .stock-section button:hover {
            background-color: #4CAF50;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            /* Navbar styles for mobile */
            nav {
                padding: 8px;
            }

            nav a {
                padding: 8px 15px;
                font-size: 14px;  /* Adjust font size for mobile devices */
            }
        }

        @media (max-width: 480px) {
            /* Further reduce font size for very small screens */
            nav a {
                padding: 6px 12px;
                font-size: 12px;  /* Adjust font size for smaller screens */
            }
        }

    </style>

</head>
<body>

    <!-- Navigation Links (Navbar) -->
    <nav>
        <a href="javascript:void(0)" onclick="showSection('dashboard')">Dashboard</a>
        <a href="javascript:void(0)" onclick="showSection('stockIn')">Stock In</a>
        <a href="javascript:void(0)" onclick="showSection('stockOut')">Stock Out</a>
    </nav>

    <!-- Dashboard Section -->
    <section id="dashboard" class="active">
        <h2>PAVITHRA TYRESS<br/> <span>TRUCK ALIGNMENT</span></h2>

        <!-- Search Bar -->
        <input type="text" id="search-input" placeholder="Tyre Pattern Name" oninput="filterTable()">

        <!-- Sync Icon -->
        <div id="sync-icon" onclick="fetchData()">&#x21bb;</div>

        <!-- Table to Display Stock Data -->
        <table id="sheet-data-table">
            <thead>
                <tr>
                    <th>S/No</th>
                    <th>Tyre Pattern</th>
                    <th>Stocks/Units</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </section>

    <!-- Stock In Section -->
    <section id="stockIn">
        <h2>Stock In</h2>
        <select id="stockInTyrePattern">
            <!-- Dropdown options will be populated dynamically -->
        </select>
        <input type="number" id="stockInNumber" placeholder="Number of Items to Add" />
        <button onclick="addStockIn()">Add Stock In</button>
    </section>

    <!-- Stock Out Section -->
    <section id="stockOut">
        <h2>Stock Out</h2>

        <!-- New Input Fields -->
        <input type="date" id="stockOutDate" placeholder="Date" />
        <select id="stockOutTyrePattern">
            <!-- Dropdown options will be populated dynamically -->
        </select>
        <input type="number" id="stockOutNumber" placeholder="Number of Items to Remove" />
        <input type="text" id="stockOutCustomerName" placeholder="Customer Name" />
        <input type="text" id="stockOutVehicleNo" placeholder="Vehicle No" />
        <input type="tel" id="stockOutMobile" placeholder="Mobile" />
        <input type="text" id="stockOutTyreSerialNo" placeholder="Tyre Serial No" />
        <input type="number" id="stockOutPrice" placeholder="Price" />
        <input type="text" id="stockOutRemarks" placeholder="Remarks" />
        <input type="number" id="stockOutSalesValue" placeholder="Sales Value" />
        
        <!-- Submit Button -->
        <button onclick="addStockOut()">Add Stock Out</button>
    </section>

    <script>
        const tyrePatterns = [
            '11.00 R20 LDR', '11.00 R20 RA1', '11.00 R20 RA', '11.00 R20 MD',
            'T/L 295/80 R22.5 RA', 'T/L 295/80 R22.5 RD', 'T/L 235/75 R17.5 RA',
            'T/L 235/75 R17.5 RD', 'T/L 215/75 R17.5 RD', '295/90 R20 MD',
            '295/90 R20 MD+', '295/90 R20 ENDUTRAX MA', '295/90 R20 RA',
            '295/90 R20 LD', '295/90 R20 RA(T)', '295/90 R20 MA', '10.00 20 AMAR GOLD',
            '10.00 20 XT-7 GOLD', '9.00 20 LD', '900 16 TERRA', '8.25 R 20 LD',
            '8.25 R 20 RA', '8.25 R 20 RA(T)', '8.25 20 Amar Gold', '8.25 20 XT - 7GOLD',
            '8.25 R16 LD', '8.25 R16 RA', '8.25 16 Vihan Lug', '8.25 16 Vihan Rib',
            '7.50 R16 LD', '7.50 R16 RA', '7.50 16 VIHAN  RIB', '7.00 16 VIHAN  RIB',
            '7.00 R16 RA', '7.00 16 VIHAN LUG', '16.9 -28 Y-LON', '13.00-24 ARG217',
            'Michelin 295/90 R20 Xmulti HDZ'
        ];

        // Function to populate dropdowns with tyre patterns
        function populateDropdowns() {
            const stockInDropdown = document.getElementById('stockInTyrePattern');
            const stockOutDropdown = document.getElementById('stockOutTyrePattern');

            tyrePatterns.forEach(pattern => {
                let optionIn = document.createElement('option');
                optionIn.value = pattern;
                optionIn.textContent = pattern;
                stockInDropdown.appendChild(optionIn);

                let optionOut = document.createElement('option');
                optionOut.value = pattern;
                optionOut.textContent = pattern;
                stockOutDropdown.appendChild(optionOut);
            });
        }

        // Fetch data from Google Sheets URL and populate the table
        function fetchData() {
            fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vTLwg0FY-mqPOBbM0UbBjPNq-wygnY_T9SUgrFXhiUWWpXPRdGzdUdmQP2KfN9XCkcgKOHDEWazeuoB/pub?gid=1423507243&single=true&output=csv')
                .then(response => response.text())
                .then(data => {
                    const rows = data.split('\n').map(row => row.split(','));
                    const tbody = document.querySelector('#sheet-data-table tbody');
                    tbody.innerHTML = '';

                    rows.forEach((row, index) => {
                        if (index === 0 || row.length === 1 && row[0] === '') return;

                        const tr = document.createElement('tr');
                        row.forEach((cell, colIndex) => {
                            const td = document.createElement('td');
                            td.textContent = cell.trim();
                            if (colIndex === 2) {
                                const stockValue = parseFloat(cell.trim());
                                if (stockValue < 2) {
                                    td.classList.add('stocks-red');
                                } else if (stockValue >= 6) {
                                    td.classList.add('stocks-green');
                                } else {
                                    td.classList.add('stocks-normal');
                                }
                            }
                            tr.appendChild(td);
                        });

                        tbody.appendChild(tr);
                    });
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        // Add stock-in (send data to Apps Script Web App)
        function addStockIn() {
            const tyrePattern = document.getElementById('stockInTyrePattern').value.trim();
            const stockNumber = parseInt(document.getElementById('stockInNumber').value);

            if (tyrePattern && !isNaN(stockNumber)) {
                fetch('https://script.google.com/macros/s/AKfycbx6ZeNGO22qbRFOusjO6TmtoZMUdz8vtmZ8HD4SySHRm2qXWM9efDXrknEfwD8W9igrYA/exec', {  
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'stockIn',
                        tyrePattern: tyrePattern,
                        number: stockNumber
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    fetchData(); // Reload data after update
                })
                .catch(error => alert('Error updating stock in: ' + error));
            } else {
                alert('Please provide valid data.');
            }
        }

        // Add stock-out (send data to Apps Script Web App)
        function addStockOut() {
            const tyrePattern = document.getElementById('stockOutTyrePattern').value.trim();
            const stockNumber = parseInt(document.getElementById('stockOutNumber').value);
            const customerName = document.getElementById('stockOutCustomerName').value.trim();
            const vehicleNo = document.getElementById('stockOutVehicleNo').value.trim();
            const mobile = document.getElementById('stockOutMobile').value.trim();
            const tyreSerialNo = document.getElementById('stockOutTyreSerialNo').value.trim();
            const price = parseFloat(document.getElementById('stockOutPrice').value);
            const remarks = document.getElementById('stockOutRemarks').value.trim();
            const salesValue = parseFloat(document.getElementById('stockOutSalesValue').value);

            if (tyrePattern && !isNaN(stockNumber)) {
                fetch('https://script.google.com/macros/s/AKfycbwG8r71WeTCaaPD0rE-hrq_6Xp_fgevly_FPTCO3pNnuEE_J4WsaR5vFx5qqRLuxyM1Hw/exec', {  
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'stockOut',
                        tyrePattern: tyrePattern,
                        number: stockNumber,
                        customerName: customerName,
                        vehicleNo: vehicleNo,
                        mobile: mobile,
                        tyreSerialNo: tyreSerialNo,
                        price: price,
                        remarks: remarks,
                        salesValue: salesValue,
                        date: document.getElementById('stockOutDate').value
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);
                    fetchData(); // Reload data after update
                })
                .catch(error => alert('Error updating stock out: ' + error));
            } else {
                alert('Please provide valid data.');
            }
        }

        // Show specific section when clicked
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(section => {
                section.classList.remove('active');
            });

            document.getElementById(sectionId).classList.add('active');
        }

        // Filter table based on search input
        function filterTable() {
            const filter = document.getElementById('search-input').value.toUpperCase();
            const rows = document.querySelector('#sheet-data-table tbody').rows;

            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                const patternCell = cells[1]; // Column with the pattern name

                if (patternCell) {
                    const patternText = patternCell.textContent || patternCell.innerText;
                    if (patternText.toUpperCase().indexOf(filter) > -1) {
                        rows[i].style.display = '';
                    } else {
                        rows[i].style.display = 'none';
                    }
                }
            }
        }

        // Initialize dropdown and fetch initial data
        populateDropdowns();
        fetchData();
    </script>

</body>
</html>
